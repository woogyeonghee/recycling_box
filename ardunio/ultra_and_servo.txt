#include <Servo.h>

//ultrasonic
int trig = 2;
int echo = 3;
float duration;
float tmp_distance;
float distance[3] = {0,0,0};

//servo
Servo srv1;
Servo srv2;
int pos = 30;

void servo(void);
void ultra(void);
int tmp_flag=0;

void setup() {
  Serial.begin(9600);  
  
  //ultrasonic
  pinMode(trig,OUTPUT);
  pinMode(echo,INPUT);

  //servo
  srv1.attach(9);
  srv2.attach(10);
  
  //buzzer
  pinMode(13,OUTPUT);
}

void loop() {
  srv1.write(pos);
  srv2.write(pos);
  ultra();
  servo();
}

void servo(void){
//set default
  if(tmp_flag==1){
  if(Serial.available() > 0) {
    char ch = Serial.read();

    //run can 
    if     (ch == 'C' && pos==30) {     
        delay (1000);
        pos =pos+150;
        srv1.write(pos);
        delay(1000);
        pos =pos-150;
        srv1.write(pos);
        tmp_flag=0;
      }
    //run bottle
    if      (ch=='B' && pos==30) {
      delay (1000);
        pos =pos+150;
        srv2.write(pos);
        delay(1000);
        pos =pos-150;
        srv2.write(pos);
        tmp_flag=0;
   }
    //not bottle and can
    if	(ch =='N'){
        digitalWrite(13,HIGH);
        delay(1000);
        digitalWrite(13,LOW);
        tmp_flag=0;
    }
  }
  }
}

void ultra() {
  if(tmp_flag==0){
  for(int i=0;i<3;i++)
  {
    digitalWrite(trig,HIGH);
    delay(10);
    digitalWrite(trig,LOW);
    duration = pulseIn(echo,HIGH);     //pulseIn함수의 단위는 ms(마이크로 세컨드)
    tmp_distance = ((34000*duration)/1000000)/2;
    distance[i] =tmp_distance;
    delay(100);
  }
  if(distance[0]<15 && distance[1]<15 && distance[2]<15){
    Serial.print("P");
    tmp_flag=1;
  }
  }
}